{% extends "layout.html" %}
{% block title %}LETSSSSS BATTLE!{% endblock %}
{% block content %}
<head>
    <style>
        .jumbotron{
            width: 60vw;
            padding: 3vw;
            background: rgba(255, 255, 255, 0.7);
            font-size: 2vw
        }

        .player-info{
            width: 35vw;
            padding: 2vw;
            background: rgba(255, 255, 255, 0.7);
            border-radius:10px;
            transition: all 1s;
        }
    </style>

</head>
<body>
<div class="center">
    <div class="jumbotron">
    {% if nextIndex != None %}
         <form action="/playgame/newround" method="get" style="text-align: center;">
             <audio autoplay id="roundwin">
                <source src="{{ url_for('static', filename='Audio/round-victory.mp3') }}" type="audio/mpeg">
             </audio>
             <input type="hidden" name="nextIndex" value="{{nextIndex}}">
             <input type="hidden" name="numplayers" value="{{numplayers}}">
             {% if playerIndex == 0 %}
             {{player1Cards[0].name}} used its {{atttype}} move!
             {% elif playerIndex == 1 %}
             {{player2Cards[0].name}} used its {{atttype}} move!
             {% endif %}
             <button id="continueNRButton" class="">Continue to next round?</button>
         </form>
    {% elif nextIndex == None %}
        {% if (playerIndex == 0 and players[0][0:6] == 'Player') or (playerIndex == 1 and players[1][0:6] == 'Player') %}
        <form action="/playgame/attack" method="get">
            <input type="hidden" name="playerIndex" value="{{playerIndex}}">
            <input type="hidden" name="numplayers" value="{{numplayers}}">
            {{players[playerIndex]}}, What type would you like to attack with?
            <select class="select-box" name="atttype" id="typesSelect">
                {% if playerIndex == 0 %}
                    {% set typeList = player1Cards[0].types.split(',') %}
                {% elif playerIndex == 1 %}
                    {% set typeList = player2Cards[0].types.split(',') %}
                {% endif %}
                {% for type in typeList %}
                    <option class="select-box" value="{{ type  }}">{{  type  }}</option>
                {% endfor %}
            </select>
            <button class="">Attack!</button><br>
        </form>
        {% else %}
        <form action="/playgame/attack" method="get">
            {% if playerIndex == 0 %}
                {% set typeList = player1Cards[0].types.split(',') %}
            {% elif playerIndex == 1 %}
                {% set typeList = player2Cards[0].types.split(',') %}
            {% endif %}
            {% set atttype = typeList|random %}
            Please press continue to see the results..
            <input type="hidden" name="atttype" value="{{atttype}}">
            <input type="hidden" name="playerIndex" value="{{playerIndex}}">
            <input type="hidden" name="numplayers" value="{{numplayers}}">
             <button class="">Continue?</button>
         </form>
        {% endif %}
    {% endif %}
    </div>
</div>
<div class="float-container" style="font-size: 2vw;">
     <div class="float-child">
        <div class="pokemon-card-container">
            <div id="leftcard" class="player-info">
                Number of Cards = {{player1Cards|length}}
                {% if playerIndex == 1 %}
                        <div><b>Defender - {{players[0]}}</b></div>
                    {% elif playerIndex == 0 %}
                        <div><b>Attacker - {{players[0]}}</b></div>
                {% endif %}
                {% if nextIndex == 0 %}
                    <b><div id="leftplayer">WINNER!</div></b>
                {% elif nextIndex == 1 %}
                    <b><div id="leftplayer">LOSER...</div></b>
                {% endif %}
                {% if playerIndex == 1 and nextIndex == None%}
                        <div class="inner-container">
                            <img src="https://cdn2.bulbagarden.net/upload/1/17/Cardback.jpg" class="pokemon-card">
                        </div>
                {% else %}
                    {% if evolveFlag == 1 and nextIndex == 0 %}
                    <div class="inner-container" style="display:none" id="leftPostEvolve">
                        <img src="https://i.pinimg.com/originals/ed/c7/c6/edc7c6437653ab73346c7bf08c884077.jpg" class="pokemon-card">
                            <span class="name-position" id="pokemonName">{{  evolvedCard.name  }}</span>
                            <span class="stats-position" id="pokemonStats">Attack: {{  evolvedCard.attack  }} Defence: {{  evolvedCard.defence  }}</span>
                            <span class="types-position" id="pokemonTypes">{{  evolvedCard.types  }}</span>
                            <img class="pokemon-image-position" id="pokemonImage" src="{{  evolvedCard.image  }}">
                            <img class="pokemon-image-position" id="explosionGIF" src="{{ url_for('static', filename='Images/explosion.gif') }}" style="display:block">
                        <!--                            <img class="pokemon-image-position" id="pokemonImage" src="{{ url_for('static', filename='Images/evolve.gif') }}">-->
                    </div>
                    <div class="inner-container" style="display:block" id="leftPreEvolve">
                        <img src="https://i.pinimg.com/originals/ed/c7/c6/edc7c6437653ab73346c7bf08c884077.jpg" class="pokemon-card">
                            <span class="name-position" id="pokemonName">{{  player1Cards[0].name  }}</span>
                            <span class="stats-position" id="pokemonStats">Attack: {{  player1Cards[0].attack  }} Defence: {{  player1Cards[0].defence  }}</span>
                            <span class="types-position" id="pokemonTypes">{{  player1Cards[0].types  }}</span>
                            <img class="pokemon-image-position" id="pokemonImage" src="{{  player1Cards[0].image  }}">
                    </div>
                    {% else %}
                    <div class="inner-container" >
                        <img src="https://i.pinimg.com/originals/ed/c7/c6/edc7c6437653ab73346c7bf08c884077.jpg" class="pokemon-card">
                            <span class="name-position" id="pokemonName">{{  player1Cards[0].name  }}</span>
                            <span class="stats-position" id="pokemonStats">Attack: {{  player1Cards[0].attack  }} Defence: {{  player1Cards[0].defence  }}</span>
                            <span class="types-position" id="pokemonTypes">{{  player1Cards[0].types  }}</span>
                            <img class="pokemon-image-position" id="pokemonImage" src="{{  player1Cards[0].image  }}">

                    </div>
                    {% endif %}
                {% endif %}
            </div>
        </div>
    </div>
    <div class="float-child">
        <div class="pokemon-card-container">
            <div id="rightcard" class="player-info">
            Number of Cards = {{player2Cards|length}}
            {% if playerIndex == 0 %}
                <div><b>Defender - {{players[1]}}</b></div>
            {% elif playerIndex == 1 %}
                <div><b>Attacker - {{players[1]}}</b></div>
            {% endif %}
            {% if nextIndex == 1 %}
                <b><div id="rightplayer">WINNER!</div></b>
            {% elif nextIndex == 0 %}
                <b><div id="rightplayer">LOSER...</div></b>
            {% endif %}
            {% if playerIndex == 0 and nextIndex == None %}
                <div class="inner-container">
                    <img src="https://cdn2.bulbagarden.net/upload/1/17/Cardback.jpg" class="pokemon-card">
                </div>
            {% else %}
                {% if evolveFlag == 1 and nextIndex == 1 %}
                    <div class="inner-container" style="display:none" id="rightPostEvolve">
                        <img src="https://i.pinimg.com/originals/ed/c7/c6/edc7c6437653ab73346c7bf08c884077.jpg" class="pokemon-card">
                            <span class="name-position" id="pokemonName">{{  evolvedCard.name  }}</span>
                            <span class="stats-position" id="pokemonStats">Attack: {{  evolvedCard.attack  }} Defence: {{  evolvedCard.defence  }}</span>
                            <span class="types-position" id="pokemonTypes">{{  evolvedCard.types  }}</span>
                            <img class="pokemon-image-position" id="pokemonImage" src="{{  evolvedCard.image  }}">
                            <img class="pokemon-image-position" id="explosionGIF" src="{{ url_for('static', filename='Images/explosion.gif') }}" style="display:block">
                    </div>
                    <div class="inner-container" style="display:block" id="rightPreEvolve">
                        <img src="https://i.pinimg.com/originals/ed/c7/c6/edc7c6437653ab73346c7bf08c884077.jpg" class="pokemon-card">
                            <span class="name-position" id="pokemonName">{{  player2Cards[0].name  }}</span>
                            <span class="stats-position" id="pokemonStats">Attack: {{  player2Cards[0].attack  }} Defence: {{  player2Cards[0].defence  }}</span>
                            <span class="types-position" id="pokemonTypes">{{  player2Cards[0].types  }}</span>
                            <img class="pokemon-image-position" id="pokemonImage" src="{{  player2Cards[0].image  }}">
                    </div>
                    {% else %}
                    <div class="inner-container">
                        <img src="https://i.pinimg.com/originals/ed/c7/c6/edc7c6437653ab73346c7bf08c884077.jpg" class="pokemon-card">
                        <span class="name-position" id="pokemonName2">{{  player2Cards[0].name  }}</span>
                        <span class="stats-position" id="pokemonStats2">Attack: {{  player2Cards[0].attack  }} Defence: {{  player2Cards[0].defence  }}</span>
                        <span class="types-position" id="pokemonTypes2">{{  player2Cards[0].types  }}</span>
                        <img class="pokemon-image-position" id="pokemonImage2" src="{{  player2Cards[0].image  }}">
                    </div>
                    {% endif %}
            {% endif %}
            </div>
        </div>
    </div>
</div>

<audio autoplay loop id="background">
    <source src="{{ url_for('static', filename='Audio/Battle_Theme.mp3') }}" type="audio/mpeg">
</audio>

<script>
    document.getElementById("background").play;
    var background_music = document.getElementById("background");
    background_music.volume = 0.02;

    document.getElementById("roundwin").play;
    var round_win_music = document.getElementById("roundwin");
    round_win_music.volume = 0.1;

    var audio_evolve = new Audio("{{ url_for('static', filename='Audio/JOHN.mp3') }}");
    audio_evolve.volume = 0.1;

    function showresults() {
        var leftplayer = document.getElementById("leftplayer").innerHTML
        var rightplayer = document.getElementById("rightplayer").innerHTML
        if (leftplayer == 'WINNER!') {
            leftcolour = "#008000";
        } else {
            leftcolour = "#8B0000";
        }
        if (rightplayer == 'WINNER!') {
            rightcolour = "#008000";
        } else {
            rightcolour = "#8B0000";
        }
        colourLeftBox(leftcolour)
        colourRightBox(rightcolour)

        if (("{{evolveFlag}}" == "1") && ("{{nextIndex}}" == "0")) {
            DoEvolutionLeft();
        } else if (("{{evolveFlag}}" == "1") && ("{{nextIndex}}" == "1")) {
            DoEvolutionRight();
        }
    }

    function colourRightBox(rightcolour) {
        document.getElementById('rightcard').style.background = rightcolour;
            setTimeout(function(){
                document.getElementById('rightcard').style.background = "";
            }, 2000);
    }

    function colourLeftBox(leftcolour) {
        document.getElementById('leftcard').style.background = leftcolour;
            setTimeout(function(){
                document.getElementById('leftcard').style.background = "";
            }, 2000);
    }

    window.onload = showresults();

    function DoEvolutionLeft() {
        ToggleButtonOff();
        var leftPreEvolve = document.getElementById('leftPreEvolve')
        var leftPostEvolve = document.getElementById('leftPostEvolve')
        var explosionGIF = document.getElementById('explosionGIF')

        setTimeout(function(){
            audio_evolve.play();
        }, 2000);

        setTimeout(function(){
            leftPreEvolve.style.display = "none";
            leftPostEvolve.style.display = "block";
        }, 4500);

        setTimeout(function(){
            explosionGIF.style.display = "none";
        }, 8500);
    }

    function DoEvolutionRight() {
        ToggleButtonOff();
        var rightPreEvolve = document.getElementById('rightPreEvolve')
        var rightPostEvolve = document.getElementById('rightPostEvolve')
        var explosionGIF = document.getElementById('explosionGIF')

        setTimeout(function(){
            audio_evolve.play();
        }, 2000);

        setTimeout(function(){
            rightPreEvolve.style.display = "none";
            rightPostEvolve.style.display = "block";
        }, 4500);

        setTimeout(function(){
            explosionGIF.style.display = "none";
        }, 8500);
    }

     function ToggleButtonOff() {
        document.getElementById("continueNRButton").disabled = true;
        setTimeout(function(){
            document.getElementById("continueNRButton").disabled = false;
        }, 10000);
    }

</script>
<!--    else if (if evolveFlag == 1 && nextIndex == 1) {-->
<!--        window.onload = DoEvolutionRight();-->
<!--    }-->

</body>
{% endblock %}